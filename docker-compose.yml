services:
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"

  livekit-server:
    image: livekit/livekit-server:latest
    ports:
      - "7880:7880"
      - "7881:7881"
      - "50000-50100:50000-50100/udp"
    command: >
      --dev
      --bind 0.0.0.0
      --redis-host redis:6379
      --port 7880
      --rtc.tcp-port 7881
      --rtc.port-range-start 50000
      --rtc.port-range-end 50100
      --keys "${LIVEKIT_API_KEY:-devkey}: ${LIVEKIT_API_SECRET:-secret}"
    depends_on:
      - redis

  voice-agent:
    build:
      context: ./voice-agent
      dockerfile: Dockerfile
    environment:
      - LIVEKIT_URL=ws://livekit-server:7880
      - LIVEKIT_API_KEY=${LIVEKIT_API_KEY:-devkey}
      - LIVEKIT_API_SECRET=${LIVEKIT_API_SECRET:-secret}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - AGENT_MODE=${AGENT_MODE:-pipeline}
    depends_on:
      - livekit-server

  web-frontend:
    build:
      context: ./web-frontend
      dockerfile: Dockerfile
    ports:
      - "8000:8000"
    environment:
      - PORT=8000
      - LIVEKIT_URL=ws://localhost:7880
      - LIVEKIT_API_KEY=${LIVEKIT_API_KEY:-devkey}
      - LIVEKIT_API_SECRET=${LIVEKIT_API_SECRET:-secret}
    depends_on:
      - livekit-server
